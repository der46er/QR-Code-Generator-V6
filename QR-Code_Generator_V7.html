<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Base & Transition Styles --- */
        :root {
            --transition-speed: 0.3s;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        /* --- Default (Light) Mode Styles --- */
        body {
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            max-width: 520px;
            width: 90%;
            transition: background-color var(--transition-speed), box-shadow var(--transition-speed), border var(--transition-speed), backdrop-filter var(--transition-speed);
        }
        h1 {
            color: #333;
            transition: color var(--transition-speed);
            margin-bottom: 15px;
            font-size: 2.2rem;
        }
        #qrText {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border-radius: 6px;
            font-size: 18px;
            border: 2px solid #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
            transition: all var(--transition-speed) ease;
            background-color: #fff;
            color: #333;
            box-sizing: border-box;
        }
        #qrText:hover,
        #qrText:focus {
            border-color: #0056b3;
            box-shadow: 0 0 12px rgba(0, 123, 255, 0.7);
            outline: none;
        }
        .template-buttons button {
            padding: 8px 15px; border: none; border-radius: 4px; color: white; cursor: pointer;
            font-size: 14px; transition: background-color 0.2s, filter 0.2s, transform 0.2s;
        }
        .template-buttons button[data-prefix*="facebook.com"] { background: linear-gradient(45deg, #3b5998, #8b9dc3); }
        .template-buttons button[data-prefix*="instagram.com"] { background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); }
        .template-buttons button[data-prefix*="tiktok.com"] { background: linear-gradient(45deg, #25f4ee, #fe2c55); }
        .template-buttons button[data-prefix*="https://www.youtube.com/"] { background: linear-gradient(45deg, #ff0000, #c4302b); }
        .template-buttons button[data-prefix*="twitter.com"] { background: linear-gradient(45deg, #000000, #4A90E2); }
        .template-buttons button[data-prefix*="linkedin.com"] { background: linear-gradient(45deg, #0077b5, #00a0dc); }
        .template-buttons button[data-prefix*="wa.me"] { background: linear-gradient(45deg, #25D366, #128C7E); }
        .template-buttons button[data-prefix*="github.com"] { background: linear-gradient(45deg, #333, #555); }
        .template-buttons button[data-prefix*="discord.com"] { background: linear-gradient(45deg, #5865F2, #7289da); }
        .template-buttons button:hover { filter: brightness(85%); }


        /* --- Dark Mode Styles --- */
        body.dark-mode {
            background-color: #222;
            color: #eee;
        }
        body.dark-mode .container {
            background-color: #333;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        body.dark-mode h1 { color: #eee; }
        body.dark-mode #qrText {
            background-color: #444;
            color: #eee;
            border-color: #007bff;
        }
        body.dark-mode .format-control { background: #444; }
        body.dark-mode .format-control button { color: #ccc; }
        body.dark-mode .format-control button.active { color: #fff; background-color: #007bff; }
        body.dark-mode .settings-menu .dropdown-content { background-color: #444; border-color: #666; }
        body.dark-mode .dropdown-content h3 { color: #eee; border-color: #666; }
        body.dark-mode .dropdown-content p, body.dark-mode .dropdown-content ol { color: #ddd; }
        body.dark-mode .menu-item:hover { background-color: #5a5a5a; }
        body.dark-mode .copyright { color: #bbb; border-color: #555; }
        body.dark-mode .menu-item { color: #eee; }
        body.dark-mode .modal-box { background-color: #333; color: #eee;}
        body.dark-mode .modal-close-btn { color: #eee; }

        /* --- Glass Mode Styles (Replaced with V6 code) --- */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body.glass-mode {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #ffffff;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            overflow: hidden;
        }

        body.glass-mode .container {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 35px 40px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        body.glass-mode h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
            margin-bottom: 25px;
        }

        body.glass-mode #qrText {
            padding: 14px 45px 14px 20px;
            border-radius: 12px;
            font-size: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.25);
            color: #fff;
        }
        body.glass-mode #qrText::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        body.glass-mode #qrText:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }

        body.glass-mode .template-buttons button {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.glass-mode .template-buttons button:hover {
            background: rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
        }
        
        body.glass-mode .format-control {
             background: rgba(0,0,0,0.2);
             border: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.glass-mode .format-control button {
             color: rgba(255, 255, 255, 0.7);
        }
        body.glass-mode .format-control button.active {
             background: rgba(255, 255, 255, 0.2);
             color: #fff;
        }
        
        body.glass-mode .action-button, 
        body.glass-mode .color-picker-button {
             border: 1px solid rgba(255, 255, 255, 0.1);
             background: rgba(0, 0, 0, 0.2);
             border-radius: 12px;
        }
        body.glass-mode .action-button:hover, 
        body.glass-mode .color-picker-button:hover {
             background: rgba(0, 0, 0, 0.4);
             transform: translateY(-2px);
        }
        
        body.glass-mode .action-button svg, 
        body.glass-mode .color-picker-button svg {
            width: 1.1em; 
            height: 1.1em;
        }

        body.glass-mode .settings-menu .dropdown-content {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        body.glass-mode .dropdown-content h3 {
             color: rgba(255,255,255,0.6); 
             border-color: rgba(255, 255, 255, 0.1);
        }
        body.glass-mode .dropdown-content p, body.glass-mode .dropdown-content ol { 
            color: rgba(255,255,255,0.8);
        }
        body.glass-mode .menu-item {
            color: #fff;
        }
        body.glass-mode .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        body.glass-mode .copyright {
            color: rgba(255,255,255,0.4);
            border-color: rgba(255, 255, 255, 0.1);
        }
        body.glass-mode #darkModeToggleContainer {
            display: none;
        }
        body.glass-mode .modal-box {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        body.glass-mode .modal-close-btn { 
            color: #fff;
        }


        /* --- Shared Component Styles --- */
        .input-wrapper { position: relative; width: 100%; margin: 0 auto 20px auto; }
        #resetTextButton {
            position: absolute; top: 50%; right: 12px; transform: translateY(-50%);
            background: transparent; border: none; padding: 5px; cursor: pointer;
            color: #ccc; transition: color 0.2s ease;
        }
        #resetTextButton:hover { color: #ef4444; }
        .dark-mode #resetTextButton, .glass-mode #resetTextButton { color: rgba(255, 255, 255, 0.4); }
        .dark-mode #resetTextButton:hover, .glass-mode #resetTextButton:hover { color: #fff; }
        #resetTextButton svg { width: 20px; height: 20px; display: block; }
        .template-buttons { margin-bottom: 25px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }

        #qr-code-wrapper { display: inline-block; margin-top: 10px; padding: 5px; border-radius: 8px; transition: background 0.5s ease; }
        canvas { display: block; }
        
        .qr-options { margin-top: 25px; display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; }
        
        .action-buttons-group {
            display: flex;
            gap: 15px;
            width: 100%;
            justify-content: center;
        }
        .action-button, .color-picker-button {
            flex-grow: 0;
            width: 50px;
            height: 50px;
            padding: 10px;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            border: none;
            box-sizing: border-box;
        }
        
        body:not(.glass-mode) #printQrCodeButton { background-color: #28a745; }
        body:not(.glass-mode) #saveQrCodeButton { background-color: #28a745; }
        body:not(.glass-mode) #refreshGradientButton { background-color: #007bff; }
        body:not(.glass-mode) .color-picker-button { background-color: #007bff; }

        body:not(.glass-mode) #printQrCodeButton:hover, 
        body:not(.glass-mode) #saveQrCodeButton:hover { background-color: #218838; }

        body:not(.glass-mode) #refreshGradientButton:hover, 
        body:not(.glass-mode) .color-picker-button:hover { background-color: #0056b3; }
        
        .color-picker-button {
            position: relative;
        }
        .color-picker-button input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .action-button svg, .color-picker-button svg {
            width: 1.5em;
            height: 1.5em;
        }
        
        /* Format Segmented Control */
        .format-control { display: flex; background: #e9e9eb; padding: 5px; border-radius: 12px; width: 120px; margin: 0 auto; transition: background-color var(--transition-speed); }
        .format-control button {
            flex: 1; padding: 5px 10px; border: none; background: transparent; color: #333;
            font-size: 14px; font-weight: 500; cursor: pointer; border-radius: 8px; transition: all 0.3s ease;
        }
        .format-control button.active { background: #fff; color: #007bff; font-weight: 600; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

        /* Top Controls: Left & Right */
        .top-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .top-right-toggles { display: flex; align-items: center; gap: 15px; }

        /* Switches */
        .toggle-group { display: flex; align-items: center; gap: 8px; }
        .toggle-icon { font-size: 1.5em; line-height: 1; transition: color var(--transition-speed); }
        .ios-toggle-control {
            position: relative; width: 50px; height: 30px; border-radius: 15px; background-color: #e9e9eb;
            cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; padding: 0 2px; box-sizing: border-box;
        }
        .ios-toggle-control .ios-toggle-thumb {
            position: absolute; width: 26px; height: 26px; background-color: #fff; border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); transition: transform 0.2s cubic-bezier(0.45, 0, 0.55, 1); left: 2px;
        }
        .ios-toggle-control.active { background-color: #34c759; }
        .ios-toggle-control.active .ios-toggle-thumb { transform: translateX(20px); }

        /* Dark/Glass specific switch styles */
        body.dark-mode .ios-toggle-control, body.glass-mode .ios-toggle-control { background-color: rgba(0, 0, 0, 0.25); border: 1px solid rgba(255, 255, 255, 0.2); }
        body.dark-mode .ios-toggle-control.active { background-color: #2da44e; }
        body.glass-mode .ios-toggle-control.active { background-color: #23d5ab; border-color: rgba(255, 255, 255, 0.4); }
        body.dark-mode .toggle-icon, body.glass-mode .toggle-icon { color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .dark-mode-icon::before { content: '🌙'; }
        .dark-mode .dark-mode-icon::before { content: '☀️'; }
        .glass-mode-icon::before { content: '🔮'; }

        /* Unified Settings Menu */
        .settings-menu {
            position: relative;
        }
        .settings-menu .menu-button {
            background-color: transparent; border: none; font-size: 1.8em; color: #555;
            cursor: pointer; padding: 5px; transition: all 0.2s ease;
        }
        body.dark-mode .settings-menu .menu-button,
        body.glass-mode .settings-menu .menu-button { color: #fff; }
        .settings-menu .menu-button:hover { transform: scale(1.1) rotate(15deg); }

        .dropdown-content {
            display: none; 
            position: absolute; 
            top: 110%; 
            left: 0; /* Changed from right: 0 */
            min-width: 280px; 
            background-color: #fff;
            border: 1px solid #ccc; 
            border-radius: 12px; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            padding: 10px; 
            text-align: left;
            z-index: 100;
        }
        .settings-menu.menu-open .dropdown-content { display: block; }
        .dropdown-content h3 {
            margin-top: 10px; margin-bottom: 5px; padding-bottom: 5px; font-size: 0.8rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.5px; color: #666; border-bottom: 1px solid #eee;
        }
        .dropdown-content h3:first-child { margin-top: 0; }
        .dropdown-content p, .dropdown-content ol { font-size: 13px; margin: 5px 0 10px 0; line-height: 1.4; color: #333; }
        .menu-item {
            display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer;
            text-decoration: none; font-size: 14px; border-radius: 8px; transition: background-color 0.2s;
        }
        .menu-item:hover { background-color: #f0f0f0; }
        .language-options { list-style: none; padding: 0; margin: 0; max-height: 250px; overflow-y: auto; }
        .language-options li { justify-content: space-between; }
        .language-options .flag-icon { width: 20px; height: 15px; flex-shrink: 0; }
        .language-options li.active { font-weight: 600; }
        .language-options li.active .check-icon { display: block; }
        .check-icon { display: none; width: 16px; height: 16px; }
        .copyright {
            font-size: 11px; color: #999; text-align: center; margin-top: 15px;
            padding-top: 10px; border-top: 1px solid #eee;
        }
        
        /* Save Preview Modal */
        #save-preview-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; /* Changed to none */
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #save-preview-overlay.visible {
            display: flex;
            opacity: 1;
        }
        .modal-box {
            background: #fff;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s ease, background-color var(--transition-speed), color var(--transition-speed);
        }
        #save-preview-overlay.visible .modal-box {
            transform: scale(1);
        }
        #preview-canvas {
            max-width: 250px;
            height: auto;
            border-radius: 8px;
            margin: 10px 0 20px;
        }
        #preview-download-button {
            display: inline-block;
            padding: 10px 25px;
            border-radius: 8px;
            background: #007bff;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        #preview-download-button:hover { background: #0056b3; }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 1.8rem;
            line-height: 1;
            cursor: pointer;
            color: #888;
        }
    </style>
</head>
<body>
    <!-- SVG Definitions -->
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <g id="flag-de"><rect width="20" height="15" fill="#000"/><rect y="5" width="20" height="10" fill="#D00"/><rect y="10" width="20" height="5" fill="#FFCE00"/></g>
        <g id="flag-gb"><rect width="20" height="15" fill="#012169"/><path d="M0,0L20,15M20,0L0,15" stroke="#fff" stroke-width="3"/><path d="M0,0L20,15M20,0L0,15" stroke="#C8102E" stroke-width="2"/><path d="M10,0V15M0,7.5H20" stroke="#fff" stroke-width="5"/><path d="M10,0V15M0,7.5H20" stroke="#C8102E" stroke-width="3"/></g>
        <g id="flag-es"><rect width="20" height="15" fill="#C60B1E"/><rect y="3.75" width="20" height="7.5" fill="#FFC400"/></g>
        <g id="flag-fr"><rect width="20" height="15" fill="#ED2939"/><rect width="13.33" height="15" fill="#fff"/><rect width="6.67" height="15" fill="#002395"/></g>
        <g id="flag-it"><rect width="20" height="15" fill="#009246"/><rect width="13.33" height="15" fill="#fff"/><rect width="6.67" height="15" fill="#CE2B37"/></g>
        <g id="flag-cs"><rect width="20" height="15" fill="#fff"/><rect y="7.5" width="20" height="7.5" fill="#D7141A"/><path d="M0,0L10,7.5L0,15z" fill="#11457E"/></g>
        <g id="flag-hu"><rect width="20" height="15" fill="#436F4D"/><rect width="20" height="10" fill="#fff"/><rect width="20" height="5" fill="#CD2A3E"/></g>
        <g id="flag-ru"><rect width="20" height="5" y="0" fill="#fff"/><rect width="20" height="5" y="5" fill="#0039A6"/><rect width="20" height="5" y="10" fill="#D52B1E"/></g>
        <g id="flag-cn"><rect width="20" height="15" fill="#EE1C25"/><use href="#star-cn" transform="translate(3.75 3.75) scale(1.5)" fill="#FF0"/><use href="#star-cn" transform="translate(7.5 1.5) rotate(23)" fill="#FF0"/><use href="#star-cn" transform="translate(9 3.75) rotate(45)" fill="#FF0"/><use href="#star-cn" transform="translate(7.5 6) rotate(68)" fill="#FF0"/><use href="#star-cn" transform="translate(5.25 7.5)" fill="#FF0"/></g>
        <polygon id="star-cn" points="0,-1 0.22,-0.31 0.95,-0.31 0.36,0.12 0.59,0.81 0,0.38 -0.59,0.81 -0.36,0.12 -0.95,-0.31 -0.22,-0.31"/>
        <g id="flag-jp"><rect width="20" height="15" fill="#fff"/><circle cx="10" cy="7.5" r="4.5" fill="#BC002D"/></g>
        <g id="flag-ro"><rect width="20" height="15" fill="#CE1126"/><rect width="13.33" height="15" fill="#FCD116"/><rect width="6.67" height="15" fill="#002B7F"/></g>
        <g id="flag-sa"><rect width="20" height="15" fill="#006c35"/><text x="10" y="10.5" font-size="5" fill="#fff" text-anchor="middle" font-family="sans-serif">الله أكبر</text></g>
        <g id="flag-in"><rect width="20" height="5" fill="#FF9933"/><rect y="5" width="20" height="5" fill="#FFFFFF"/><rect y="10" width="20" height="5" fill="#138808"/><circle cx="10" cy="7.5" r="1.5" fill="none" stroke="#000080" stroke-width="0.5"/></g>
        <g id="flag-pt"><rect width="20" height="15" fill="#006600"/><rect width="8" height="15" fill="#FF0000"/></g>
        <g id="flag-bd"><rect width="20" height="15" fill="#006a4e"/><circle cx="9" cy="7.5" r="4" fill="#f42a41"/></g>
        <g id="flag-id"><rect width="20" height="7.5" fill="#FF0000"/><rect y="7.5" width="20" height="7.5" fill="#FFFFFF"/></g>
        <g id="flag-pk"><rect width="20" height="15" fill="#006600"/><rect width="5" height="15" fill="#FFFFFF"/><circle cx="12.5" cy="7.5" r="3" fill="#FFFFFF"/><path d="M13,6.5 A2,2 0 0,0 12,8.4 L14.5,7.5 Z" fill="#006600"/></g>
        <g id="flag-tr"><rect width="20" height="15" fill="#E30A17"/><circle cx="8" cy="7.5" r="3.5" fill="#FFFFFF"/><circle cx="9" cy="7.5" r="2.8" fill="#E30A17"/><polygon points="12,7.5 10.5,6 11,8 10.5,10" fill="#FFFFFF"/></g>
        <g id="flag-kr"><rect width="20" height="15" fill="#FFFFFF"/><circle cx="10" cy="7.5" r="3.5" fill="#CD2E3A"/><path d="M10,4 A3.5,3.5 0 0,0 10,11" fill="#0047A0"/><g stroke="#000" stroke-width="1.2"><path d="M4,4 L6,4 M4,5 L6,5 M4,6 L6,6"/><path d="M14,4 L16,4 M14,5 L16,5 M14,6 L15,6 L15,5"/><path d="M4,9 L5,9 L5,10 L6,10 M4,11 L6,11"/><path d="M14,9 L16,9 M15,10 L14,10 M15,10 L16,10 M14,11 L16,11"/></g></g>
        <g id="flag-vn"><rect width="20" height="15" fill="#DA251D"/><polygon points="10,2.5 11.5,7.5 17,7.5 12.5,10.5 14,15.5 10,12.5 6,15.5 7.5,10.5 3,7.5 8.5,7.5" fill="#FFFF00"/></g>
        <g id="flag-pl"><rect width="20" height="7.5" fill="#FFFFFF"/><rect y="7.5" width="20" height="7.5" fill="#DC143C"/></g>
        <g id="flag-nl"><rect width="20" height="5" fill="#AE1C28"/><rect y="5" width="20" height="5" fill="#FFFFFF"/><rect y="10" width="20" height="5" fill="#21468B"/></g>
        <g id="flag-gr"><rect width="20" height="15" fill="#0D5EAF"/><path d="M0,3H20 M0,6H20 M0,9H20 M0,12H20" stroke="#FFFFFF" stroke-width="1.8"/><rect width="9" height="9" fill="#0D5EAF"/><path d="M0,4.5H9 M4.5,0V9" stroke="#FFFFFF" stroke-width="1.8"/></g>
        <g id="flag-se"><rect width="20" height="15" fill="#006AA7"/><path d="M0,7.5H20 M8,0V15" stroke="#FECC00" stroke-width="3"/></g>
        <g id="flag-dk"><rect width="20" height="15" fill="#C8102E"/><path d="M0,7.5H20 M7,0V15" stroke="#FFFFFF" stroke-width="3"/></g>
        <g id="flag-no"><rect width="20" height="15" fill="#EF2B2D"/><path d="M0,7.5H20 M7,0V15" stroke="#FFFFFF" stroke-width="4"/><path d="M0,7.5H20 M7,0V15" stroke="#002868" stroke-width="2"/></g>
        <g id="flag-fi"><rect width="20" height="15" fill="#FFFFFF"/><path d="M0,7.5H20 M8,0V15" stroke="#003580" stroke-width="4"/></g>
        <g id="flag-il"><rect width="20" height="15" fill="#FFFFFF"/><path d="M0,2.5H20 M0,12.5H20" stroke="#0038B8" stroke-width="1.5"/><path d="M10,5 L8,9 H12 Z M10,10 L8,6 H12 Z" fill="#0038B8"/></g>
        <g id="flag-th"><rect width="20" height="15" fill="#2E2A4D"/><rect width="20" height="12.5" y="1.25" fill="#FFFFFF"/><rect width="20" height="10" y="2.5" fill="#A51931"/><rect width="20" height="5" y="5" fill="#FFFFFF"/><rect width="20" height="2.5" y="6.25" fill="#2E2A4D"/></g>
        <g id="flag-ua"><rect width="20" height="7.5" fill="#005BBB"/><rect y="7.5" width="20" height="7.5" fill="#FFD500"/></g>
        <g id="flag-ir"><rect width="20" height="5" y="0" fill="#239F40"/><rect width="20" height="5" y="5" fill="#FFFFFF"/><rect width="20" height="5" y="10" fill="#DA0000"/><text x="10" y="9" font-size="4" fill="#DA0000" text-anchor="middle">الله</text></g>
        <g id="flag-my"><g fill="#C00"><path d="M0,1.5 h20 v1.5 h-20 z m0,3 h20 v1.5 h-20 z m0,3 h20 v1.5 h-20 z m0,3 h20 v1.5 h-20 z"/></g><rect width="10" height="10.5" fill="#003273"/><polygon fill="#fc0" points="5,5.25 4.2,7.5 3.3,5.25 2,7 4,6 5,2.5 6,6 8,7 6.7,5.25 7.8,7.5"/><circle cx="5" cy="5.25" r="2.2" fill="#003273"/><circle cx="5" cy="5.25" r="1.8" fill="#fc0"/></g>
        <g id="flag-za"><path fill="#007749" d="m0,0h20v15h-20z"/><path fill="#fff" d="m0,0 20,7.5-20,7.5v-2.5l15-5-15-5z"/><path fill="#000" d="m0,3.5v8l7.5-4z"/><path fill="#ffb612" d="m0,4.5v6l5-3z"/><path fill="#de3831" d="m10,0h10v7.5h-10z"/><path fill="#002395" d="m10,7.5h10v7.5h-10z"/></g>
        <g id="flag-au"><rect fill="#00008b" width="20" height="15"/><g fill="#fff"><path d="m0,0v1.5l7,5.25h1.5v-1.5l-7,-5.25h-1.5m8.5,5.25v1.5h-1.5l-7,5.25v1.5h1.5l7,-5.25v-1.5h1.5m-8.5,0h1.5v-7h-1.5m0,8.5h1.5v-1.5h-1.5m7,-8.5h1.5v7h-1.5m-7,0h7v1.5h-7m-1.5-7l7,5.25h1.5v-7h-8.5m1.5,8.5l7,-5.25h-1.5v-1.5h-7v7z"/></g><g fill="#fff"><polygon points="15,3 14,5 15,7 16,5"/><polygon points="12,9 11,11 12,13 13,11"/><polygon points="17,9 16,11 17,13 18,11"/><polygon points="15,10.5 14,12.5 15,14.5 16,12.5"/><polygon points="15,8 14.5,8.5 14,8 14.5,7.5"/></g></g>
        <g id="flag-ca"><rect width="20" height="15" fill="#fff"/><rect width="5" height="15" fill="#ff0000"/><rect x="15" width="5" height="15" fill="#ff0000"/><path fill="#ff0000" d="m10,4.5 2.5,2 -1,1 -2,-1.5 -0.5,2.5 -2,-1 -2,1 -0.5,-2.5 -2,1.5 -1,-1 2.5,-2 0.5,-2 1,1 1,-1.5 1,1.5 1,-1z"/></g>
        <g id="flag-br"><rect width="20" height="15" fill="#009B3A"/><polygon fill="#FFCC29" points="10,1 18,7.5 10,14 2,7.5"/><circle cx="10" cy="7.5" r="4" fill="#002776"/></g>
        <g id="flag-mx"><rect width="20" height="15" fill="#CE1126"/><rect width="13.33" height="15" fill="#FFFFFF"/><rect width="6.67" height="15" fill="#006847"/></g>
        <g id="flag-ar"><rect width="20" height="5" y="0" fill="#75AADB"/><rect width="20" height="5" y="5" fill="#FFFFFF"/><rect width="20" height="5" y="10" fill="#75AADB"/><circle cx="10" cy="7.5" r="1.5" fill="#F9B618"/><g stroke="#F9B618" stroke-width="0.3"><path d="M10,6.5 v-1 M10,8.5 v1 M11,7.5 h1 M9,7.5 h-1"/></g></g>
        <g id="icon-check" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></g>
      </defs>
    </svg>

    <div class="container">
        <div class="top-controls">
             <div class="settings-menu" id="settingsMenu">
                <button class="menu-button">⚙️</button>
                <div class="dropdown-content">
                    <h3 id="download-title"></h3>
                    <p id="download-p"></p>
                    <a href="#" id="downloadHtmlButton" class="menu-item">
                        <span>📄</span> <span id="download-html-text"></span>
                    </a>
                    <h3 id="instructions-title"></h3>
                    <ol id="instructions-list"></ol>
                    <h3 id="language-title"></h3>
                    <ul class="language-options" id="language-options"></ul>
                    <div class="copyright">© <a href="https://github.com/der46er" target="_blank" style="color: inherit; text-decoration: none;">Niklas Außerwöger</a> 2025</div>
                </div>
            </div>
            <div class="top-right-toggles">
                <div class="toggle-group">
                    <span class="toggle-icon glass-mode-icon"></span>
                    <div class="ios-toggle-control" id="glassModeToggleControl">
                        <div class="ios-toggle-thumb"></div>
                    </div>
                </div>
                <div class="toggle-group" id="darkModeToggleContainer">
                    <span class="toggle-icon dark-mode-icon"></span>
                    <div class="ios-toggle-control" id="darkModeToggleControl">
                        <div class="ios-toggle-thumb"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <h1 id="main-title">QR Code Generator</h1>
        <div class="input-wrapper">
             <input type="text" id="qrText" placeholder="Dein Text oder deine URL hier eingeben">
             <button id="resetTextButton" title="Eingabe löschen">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
             </button>
        </div>

        <div class="template-buttons"></div>

        <div id="qr-code-wrapper">
            <canvas id="qrCodeCanvas"></canvas>
        </div>

        <div class="qr-options">
            <div class="format-control" id="formatControl">
                <button data-format="jpeg">JPG</button>
                <button data-format="png" class="active">PNG</button>
            </div>
            <div class="action-buttons-group">
                <button id="printQrCodeButton" class="action-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19,8H5C3.34,8,2,9.34,2,11v6h4v4h12v-4h4v-6C22,9.34,20.66,8,19,8z M16,19H8v-5h8V19z M19,12c-0.55,0-1-0.45-1-1 s0.45-1,1-1s1,0.45,1,1S19.55,12,19,12z M18,3H6v4h12V3z"/></svg>
                </button>
                <button id="saveQrCodeButton" class="action-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 20h14v-2H5v2zm14-9h-4V3H9v8H5l7 7 7-7z"/></svg>
                </button>
                <button id="refreshGradientButton" class="action-button">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                </button>
                <label class="color-picker-button action-button">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-3.58-8-8-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                    <input type="color" id="bgColorPicker" value="#ffffff">
                </label>
            </div>
        </div>
    </div>

    <div id="save-preview-overlay">
        <div class="modal-box" id="save-preview-box">
            <button class="modal-close-btn" id="save-preview-close">×</button>
            <h3 id="preview-title"></h3>
            <canvas id="preview-canvas"></canvas>
            <a href="#" id="preview-download-button"></a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Element Declarations ---
            const body = document.body;
            const qrText = document.getElementById('qrText');
            const qrCodeCanvas = document.getElementById('qrCodeCanvas');
            const qrCodeWrapper = document.getElementById('qr-code-wrapper');
            const templateButtonsContainer = document.querySelector('.template-buttons');
            const darkModeToggle = document.getElementById('darkModeToggleControl');
            const darkModeToggleContainer = document.getElementById('darkModeToggleContainer');
            const glassModeToggle = document.getElementById('glassModeToggleControl');
            const bgColorPicker = document.getElementById('bgColorPicker');
            const formatControl = document.getElementById('formatControl');
            const saveQrCodeButton = document.getElementById('saveQrCodeButton');
            const printQrCodeButton = document.getElementById('printQrCodeButton');
            const refreshGradientButton = document.getElementById('refreshGradientButton');
            const resetTextButton = document.getElementById('resetTextButton');
            const downloadHtmlButton = document.getElementById('downloadHtmlButton');
            const settingsMenu = document.getElementById('settingsMenu');
            const langOptionsContainer = document.getElementById('language-options');
            const savePreviewOverlay = document.getElementById('save-preview-overlay');
            const savePreviewCanvas = document.getElementById('preview-canvas');
            const savePreviewClose = document.getElementById('save-preview-close');
            const previewDownloadButton = document.getElementById('preview-download-button');
            const previewTitle = document.getElementById('preview-title');
        
            // --- State Variables ---
            let currentSaveFormat = 'png';
            let currentLang = 'de';
            let gradientParams = {};

            // --- Data ---
            const flagMap = { de: 'de', en: 'gb', es: 'es', fr: 'fr', it: 'it', cs: 'cs', hu: 'hu', ro: 'ro', ru: 'ru', zh: 'cn', ja: 'jp', ar: 'sa', hi: 'in', pt: 'pt', bn: 'bd', id: 'id', ur: 'pk', tr: 'tr', ko: 'kr', vi: 'vn', pl: 'pl', nl: 'nl', el: 'gr', sv: 'se', da: 'dk', no: 'no', fi: 'fi', he: 'il', th: 'th', uk: 'ua', fa: 'ir', ms: 'my', af: 'za', 'en-au': 'au', 'fr-ca': 'ca', 'pt-br': 'br', 'es-mx': 'mx', 'es-ar': 'ar'};
            const socialTemplates = [
                { name: "Facebook", prefix: "https://www.facebook.com/" },
                { name: "Instagram", prefix: "https://www.instagram.com/" },
                { name: "TikTok", prefix: "https://www.tiktok.com/" },
                { name: "YouTube", prefix: "https://www.youtube.com/" },
                { name: "X (Twitter)", prefix: "https://twitter.com/" },
                { name: "LinkedIn", prefix: "https://www.linkedin.com/in/" },
                { name: "WhatsApp", prefix: "https://wa.me/" },
                { name: "GitHub", prefix: "https://github.com/" },
                { name: "Discord", prefix: "https://discord.com/" },
            ];
            const translations = {
                de: { langName: "Deutsch", langTitle: "Sprache", mainTitle: "QR Code Generator", qrPlaceholder: "Dein Text oder deine URL", saveButton: "Speichern", printButtonTitle: "Drucken", resetButtonTitle: "Eingabe löschen", refreshGradientButtonText: "Neuer Verlauf", downloadTitle: "Generator herunterladen", downloadP: "Klicke unten, um diese HTML-Datei herunterzuladen.", downloadHtmlText: "Download HTML", instructionsTitle: "So führst du die Datei aus:", instructionsList: ["Speichere die Datei (z.B. `qr_generator.html`) auf deinem Computer.", "Navigiere zum Speicherort der Datei.", "Doppelklicke auf die `qr_generator.html`-Datei.", "Der Generator ist nun offline und lokal nutzbar."], initialQrValue: "Hallo Welt!", downloadAlert: 'Datei heruntergeladen.', fileName: "qr_code", downloadFileName: "qr_code_generator.html", previewTitle: "Vorschau", previewDownload: "Herunterladen"},
                en: { langName: "English", langTitle: "Language", mainTitle: "QR Code Generator", qrPlaceholder: "Your text or URL", saveButton: "Save", printButtonTitle: "Print", resetButtonTitle: "Clear input", refreshGradientButtonText: "New Gradient", downloadTitle: "Download Generator", downloadP: "Click below to download this HTML file.", downloadHtmlText: "Download HTML", instructionsTitle: "How to run the file:", instructionsList: ["Save the file (e.g., `qr_generator.html`) on your computer.", "Navigate to where you saved the file.", "Double-click the `qr_generator.html` file.", "The generator is now usable offline and locally."], initialQrValue: "Hello World!", downloadAlert: 'File downloaded.', fileName: "qr_code", downloadFileName: "qr_code_generator.html", previewTitle: "Preview", previewDownload: "Download"},
                es: { langName: "Español", langTitle: "Idioma", mainTitle: "Generador de Códigos QR", qrPlaceholder: "Tu texto o URL", saveButton: "Guardar", printButtonTitle: "Imprimir", resetButtonTitle: "Limpiar entrada", refreshGradientButtonText: "Nuevo Gradiente", downloadTitle: "Descargar Generador", downloadP: "Haz clic abajo para descargar este archivo HTML.", downloadHtmlText: "Descargar HTML", instructionsTitle: "Cómo ejecutar el archivo:", instructionsList: ["Guarda el archivo (ej. `qr_generator.html`) en tu computadora.", "Navega hasta donde guardaste el archivo.", "Haz doble clic en el archivo `qr_generator.html`.", "El generador ya es usable sin conexión."], initialQrValue: "¡Hola Mundo!", downloadAlert: 'Archivo descargado.', fileName: "código_qr", downloadFileName: "generador_qr.html", previewTitle: "Vista Previa", previewDownload: "Descargar"},
                fr: { langName: "Français", langTitle: "Langue", mainTitle: "Générateur de Code QR", qrPlaceholder: "Votre texte ou URL", saveButton: "Sauvegarder", printButtonTitle: "Imprimer", resetButtonTitle: "Effacer l'entrée", refreshGradientButtonText: "Nouveau Dégradé", downloadTitle: "Télécharger le Générateur", downloadP: "Cliquez ci-dessous pour télécharger ce fichier HTML.", downloadHtmlText: "Télécharger HTML", instructionsTitle: "Comment exécuter :", instructionsList: ["Enregistrez le fichier (par ex. `qr_generator.html`).", "Accédez à l'emplacement du fichier.", "Double-cliquez sur le fichier `qr_generator.html`.", "Le générateur est utilisable hors ligne."], initialQrValue: "Bonjour le monde !", downloadAlert: 'Fichier téléchargé.', fileName: "code_qr", downloadFileName: "generateur_qr.html", previewTitle: "Aperçu", previewDownload: "Télécharger"},
                it: { langName: "Italiano", langTitle: "Lingua", mainTitle: "Generatore di Codici QR", qrPlaceholder: "Il tuo testo o URL", saveButton: "Salva", printButtonTitle: "Stampa", resetButtonTitle: "Cancella input", refreshGradientButtonText: "Nuovo Gradiente", downloadTitle: "Scarica Generatore", downloadP: "Clicca qui sotto per scaricare questo file HTML.", downloadHtmlText: "Scarica HTML", instructionsTitle: "Come eseguire:", instructionsList: ["Salva il file (es. `qr_generator.html`).", "Vai alla posizione del file.", "Fai doppio clic sul file `qr_generator.html`.", "Il generatore è utilizzabile offline."], initialQrValue: "Ciao Mondo!", downloadAlert: 'File scaricato.', fileName: "codice_qr", downloadFileName: "generatore_qr.html", previewTitle: "Anteprima", previewDownload: "Scarica"},
                cs: { langName: "Čeština", langTitle: "Jazyk", mainTitle: "Generátor QR kódů", qrPlaceholder: "Váš text nebo URL", saveButton: "Uložit", printButtonTitle: "Tisk", resetButtonTitle: "Vymazat vstup", refreshGradientButtonText: "Nový Přechod", downloadTitle: "Stáhnout Generátor", downloadP: "Klikněte níže pro stažení HTML.", downloadHtmlText: "Stáhnout HTML", instructionsTitle: "Jak spustit:", instructionsList: ["Uložte soubor (např. `qr_generator.html`).", "Přejděte na místo uložení.", "Dvakrát klikněte na soubor `qr_generator.html`.", "Generátor je použitelný offline."], initialQrValue: "Ahoj světe!", downloadAlert: 'Soubor stažen.', fileName: "qr_kod", downloadFileName: "generator_qr.html", previewTitle: "Náhled", previewDownload: "Stáhnout"},
                hu: { langName: "Magyar", langTitle: "Nyelv", mainTitle: "QR kód generátor", qrPlaceholder: "A szöveg vagy URL", saveButton: "Mentés", printButtonTitle: "Nyomtatás", resetButtonTitle: "Bevitel törlése", refreshGradientButtonText: "Új Színátmenet", downloadTitle: "Generátor letöltése", downloadP: "Kattintson alább a HTML fájl letöltéséhez.", downloadHtmlText: "HTML letöltése", instructionsTitle: "Futtatás:", instructionsList: ["Mentse a fájlt (pl. `qr_generator.html`).", "Navigáljon a fájl helyére.", "Kattintson duplán a `qr_generator.html` fájlra.", "A generátor offline használható."], initialQrValue: "Helló Világ!", downloadAlert: 'Fájl letöltve.', fileName: "qr_kod", downloadFileName: "qr_generator.html", previewTitle: "Előnézet", previewDownload: "Letöltés"},
                ro: { langName: "Română", langTitle: "Limbă", mainTitle: "Generator de Coduri QR", qrPlaceholder: "Textul sau URL-ul dvs.", saveButton: "Salvează", printButtonTitle: "Printează", resetButtonTitle: "Șterge intrarea", refreshGradientButtonText: "Gradient Nou", downloadTitle: "Descarcă Generatorul", downloadP: "Apasă mai jos pentru a descărca acest fișier HTML.", downloadHtmlText: "Descarcă HTML", instructionsTitle: "Cum se rulează fișierul:", instructionsList: ["Salvează fișierul (ex. `generator_qr.html`) pe computer.", "Navighează la locația fișierului.", "Dă dublu clic pe fișierul `generator_qr.html`.", "Generatorul este acum utilizabil offline și local."], initialQrValue: "Salut Lume!", downloadAlert: 'Fișier descărcat.', fileName: "cod_qr", downloadFileName: "generator_qr.html", previewTitle: "Previzualizare", previewDownload: "Descarcă"},
                ru: { langName: "Русский", langTitle: "Язык", mainTitle: "Генератор QR-кодов", qrPlaceholder: "Ваш текст или URL", saveButton: "Сохранить", printButtonTitle: "Печать", resetButtonTitle: "Очистить ввод", refreshGradientButtonText: "Новый градиент", downloadTitle: "Скачать Генератор", downloadP: "Нажмите ниже, чтобы скачать HTML.", downloadHtmlText: "Скачать HTML", instructionsTitle: "Как запустить:", instructionsList: ["Сохраните файл (например, `qr_generator.html`).", "Перейдите к файлу.", "Дважды щелкните `qr_generator.html`.", "Генератор доступен офлайн."], initialQrValue: "Привет, мир!", downloadAlert: 'Файл скачан.', fileName: "qr_код", downloadFileName: "генератор_qr.html", previewTitle: "Предпросмотр", previewDownload: "Скачать"},
                zh: { langName: "中文", langTitle: "语言", mainTitle: "二维码生成器", qrPlaceholder: "您的文本或网址", saveButton: "保存", printButtonTitle: "打印", resetButtonTitle: "清除输入", refreshGradientButtonText: "刷新渐变", downloadTitle: "下载生成器", downloadP: "点击下方下载HTML文件。", downloadHtmlText: "下载HTML", instructionsTitle: "如何运行：", instructionsList: ["保存文件 (例如 `qr_generator.html`)。", "导航到文件位置。", "双击 `qr_generator.html` 文件。", "生成器现在可以离线使用。"], initialQrValue: "你好，世界！", downloadAlert: '文件已下载。', fileName: "二维码", downloadFileName: "二维码生成器.html", previewTitle: "预览", previewDownload: "下载"},
                ja: { langName: "日本語", langTitle: "言語", mainTitle: "QRコードジェネレーター", qrPlaceholder: "テキストまたはURL", saveButton: "保存", printButtonTitle: "印刷", resetButtonTitle: "入力をクリア", refreshGradientButtonText: "グラデーション更新", downloadTitle: "ジェネレーターをダウンロード", downloadP: "下をクリックしてHTMLファイルをダウンロードします。", downloadHtmlText: "HTMLをダウンロード", instructionsTitle: "実行方法:", instructionsList: ["ファイル (例: `qr_generator.html`) を保存します。", "ファイルの場所に移動します。", "`qr_generator.html` をダブルクリックします。", "ジェネレーターはオフラインで利用できます。"], initialQrValue: "こんにちは世界！", downloadAlert: 'ダウンロードしました。', fileName: "qr_コード", downloadFileName: "qr_コードジェネレーター.html", previewTitle: "プレビュー", previewDownload: "ダウンロード"}
            };

            // --- QRious Instance ---
            const qr = new QRious({ element: qrCodeCanvas, size: 200, value: 'Hello World' });

            // --- Core Functions ---
            const applyRandomGradient = () => {
                const angle = Math.floor(Math.random() * 360);
                const color1 = `hsl(${Math.random() * 360}, 100%, 75%)`;
                const color2 = `hsl(${Math.random() * 360}, 100%, 75%)`;
                
                qrCodeWrapper.style.background = `linear-gradient(${angle}deg, ${color1}, ${color2})`;
                gradientParams = { angle, color1, color2 };
                if (savePreviewOverlay.classList.contains('visible')) updatePreview();
            };

            const updateQrCode = () => {
                const text = qrText.value;
                qr.value = text || translations[currentLang]?.initialQrValue || 'Hello World';
                qr.background = bgColorPicker.value;
                qr.update();
                if (savePreviewOverlay.classList.contains('visible')) updatePreview();
            };

            const setLanguage = (lang) => {
                if (!translations[lang]) return;
                currentLang = lang;
                const t = translations[lang];

                document.title = t.mainTitle;
                document.getElementById('main-title').textContent = t.mainTitle;
                document.getElementById('download-title').textContent = t.downloadTitle;
                document.getElementById('download-p').textContent = t.downloadP;
                document.getElementById('download-html-text').textContent = t.downloadHtmlText;
                document.getElementById('instructions-title').textContent = t.instructionsTitle;
                document.getElementById('language-title').textContent = t.langTitle;
                previewTitle.textContent = t.previewTitle;
                previewDownloadButton.textContent = t.previewDownload;
                
                qrText.placeholder = t.qrPlaceholder;
                resetTextButton.title = t.resetButtonTitle;
                printQrCodeButton.title = t.printButtonTitle;
                saveQrCodeButton.title = t.saveButton;
                refreshGradientButton.title = t.refreshGradientButtonText;

                const instructionsListEl = document.getElementById('instructions-list');
                instructionsListEl.innerHTML = '';
                t.instructionsList.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = item.replace(/`([^`]+)`/g, '<code>$1</code>');
                    instructionsListEl.appendChild(li);
                });
                
                langOptionsContainer.querySelectorAll('li').forEach(li => li.classList.remove('active'));
                langOptionsContainer.querySelector(`li[data-lang="${lang}"]`)?.classList.add('active');
                
                if (Object.values(translations).map(trans => trans.initialQrValue).includes(qr.value) || !qrText.value) {
                     qrText.value = '';
                     updateQrCode();
                }

                localStorage.setItem('qrGeneratorLanguage', lang);
            };
            
            const toggleMode = (mode, toggleElement) => {
                body.classList.toggle(mode);
                const isActive = body.classList.contains(mode);
                toggleElement.classList.toggle('active', isActive);
                localStorage.setItem(`qrGenerator${mode.charAt(0).toUpperCase() + mode.slice(1)}`, isActive ? 'enabled' : 'disabled');
            };
            
            const getQrWithBorder = () => {
                const tempCanvas = document.createElement('canvas');
                const ctx = tempCanvas.getContext('2d');
                const padding = 10;
                const width = qrCodeCanvas.width + padding * 2;
                const height = qrCodeCanvas.height + padding * 2;

                tempCanvas.width = width;
                tempCanvas.height = height;
                
                if (gradientParams.color1) {
                    const rad = gradientParams.angle * Math.PI / 180;
                    const x1 = width / 2 - Math.cos(rad) * width / 2;
                    const y1 = height / 2 - Math.sin(rad) * height / 2;
                    const x2 = width / 2 + Math.cos(rad) * width / 2;
                    const y2 = height / 2 + Math.sin(rad) * height / 2;
                    
                    const gradient = ctx.createLinearGradient(x1, y1, x2, y2);
                    gradient.addColorStop(0, gradientParams.color1);
                    gradient.addColorStop(1, gradientParams.color2);
                    ctx.fillStyle = gradient;
                } else {
                    ctx.fillStyle = '#ffffff';
                }

                ctx.fillRect(0, 0, width, height);
                ctx.drawImage(qrCodeCanvas, padding, padding);
                return tempCanvas;
            };

            const updatePreview = () => {
                const finalImageCanvas = getQrWithBorder();
                const previewCtx = savePreviewCanvas.getContext('2d');
                savePreviewCanvas.width = finalImageCanvas.width;
                savePreviewCanvas.height = finalImageCanvas.height;
                previewCtx.drawImage(finalImageCanvas, 0, 0);
            };

            // --- UI Setup ---
            const populateStaticUI = () => {
                templateButtonsContainer.innerHTML = socialTemplates.map(template =>
                    `<button data-prefix="${template.prefix}">${template.name}</button>`
                ).join('');

                langOptionsContainer.innerHTML = Object.entries(translations).sort((a,b) => a[1].langName.localeCompare(b[1].langName)).map(([key, value]) =>
                     `<li data-lang="${key}" class="menu-item">
                        <svg class="flag-icon"><use href="#flag-${flagMap[key] || key}"></use></svg>
                        <span>${value.langName}</span>
                        <svg class="check-icon"><use href="#icon-check"></use></svg>
                     </li>`
                ).join('');
            };

            // --- Event Handlers ---
            const setupEventListeners = () => {
                qrText.addEventListener('input', updateQrCode);
                bgColorPicker.addEventListener('input', updateQrCode);
                darkModeToggle.addEventListener('click', () => toggleMode('dark-mode', darkModeToggle));
                glassModeToggle.addEventListener('click', () => toggleMode('glass-mode', glassModeToggle));
                refreshGradientButton.addEventListener('click', applyRandomGradient);
                resetTextButton.addEventListener('click', () => { qrText.value = ''; updateQrCode(); qrText.focus(); });
                
                formatControl.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        currentSaveFormat = e.target.dataset.format;
                        formatControl.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                    }
                });
                
                templateButtonsContainer.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        const prefix = e.target.dataset.prefix;
                        qrText.value = prefix;
                        updateQrCode();
                        qrText.focus();
                        qrText.setSelectionRange(prefix.length, prefix.length);
                    }
                });

                langOptionsContainer.addEventListener('click', (e) => {
                    const li = e.target.closest('li');
                    if(li) {
                        setLanguage(li.dataset.lang);
                        settingsMenu.classList.remove('menu-open');
                    }
                });

                settingsMenu.querySelector('.menu-button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    settingsMenu.classList.toggle('menu-open');
                });

                document.addEventListener('click', (e) => {
                    if (!settingsMenu.contains(e.target)) settingsMenu.classList.remove('menu-open');
                });
                
                saveQrCodeButton.addEventListener('click', () => {
                    updatePreview();
                    savePreviewOverlay.classList.add('visible');
                });
                
                printQrCodeButton.addEventListener('click', () => {
                    const dataUrl = getQrWithBorder().toDataURL('image/png');
                    const win = window.open('', '_blank');
                    win.document.write(`<img src="${dataUrl}" style="max-width:100%;" onload="window.print(); setTimeout(()=>window.close(), 100)">`);
                    win.document.close();
                });

                // Preview Modal
                savePreviewClose.addEventListener('click', () => savePreviewOverlay.classList.remove('visible'));
                savePreviewOverlay.addEventListener('click', (e) => {
                    if (e.target === savePreviewOverlay) {
                        savePreviewOverlay.classList.remove('visible');
                    }
                });

                previewDownloadButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const link = document.createElement('a');
                    link.href = savePreviewCanvas.toDataURL(`image/${currentSaveFormat}`, 1.0);
                    link.download = `${translations[currentLang].fileName || 'qr-code'}.${currentSaveFormat === 'jpeg' ? 'jpg' : 'png'}`;
                    link.click();
                });

                downloadHtmlButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = translations[currentLang].downloadFileName;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            };

            // --- Initialization ---
            const init = () => {
                populateStaticUI();
                setupEventListeners();
                
                if (localStorage.getItem('qrGeneratorDarkMode') === 'enabled') toggleMode('dark-mode', darkModeToggle);
                if (localStorage.getItem('qrGeneratorGlassMode') === 'enabled') toggleMode('glass-mode', glassModeToggle);
                
                currentSaveFormat = localStorage.getItem('qrGeneratorSaveFormat') || 'png';
                formatControl.querySelectorAll('button').forEach(btn => btn.classList.toggle('active', btn.dataset.format === currentSaveFormat));

                const savedLang = localStorage.getItem('qrGeneratorLanguage') || 'de';
                setLanguage(savedLang);
                
                applyRandomGradient();
            };

            init();
        });
    </script>
</body>
</html>
